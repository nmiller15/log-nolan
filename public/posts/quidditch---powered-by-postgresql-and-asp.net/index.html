<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">



<link rel="icon" type="image/ico" href="https://nolanmiller.me//favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://nolanmiller.me//favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://nolanmiller.me//favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="https://nolanmiller.me//android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://nolanmiller.me//apple-touch-icon.png">

<meta name="description" content="Use Entity Framework to connect Postgres to your ASP.NET API."/>



<title>
    
    Quidditch - Powered By PostgreSQL and ASP.NET | Nolan Miller
    
</title>

<link rel="canonical" href="https://nolanmiller.me/posts/quidditch---powered-by-postgresql-and-asp.net/"/>

<meta property="og:url" content="https://nolanmiller.me/posts/quidditch---powered-by-postgresql-and-asp.net/">
  <meta property="og:site_name" content="Nolan Miller">
  <meta property="og:title" content="Quidditch - Powered By PostgreSQL and ASP.NET">
  <meta property="og:description" content="Use Entity Framework to connect Postgres to your ASP.NET API.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-06-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-06-10T00:00:00+00:00">
    <meta property="article:tag" content="Postgres">
    <meta property="article:tag" content="Asp">
    <meta property="article:tag" content="Dotnet">
    <meta property="article:tag" content="Learning">













<link rel="stylesheet" href="/assets/combined.min.667f13d7f1b378e4e08609d8404b06b195d672b9d122546fac8be63ee9148ee9.css" media="all">




      <script async src="https://www.googletagmanager.com/gtag/js?id=G-729248V2CZ"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-729248V2CZ');
        }
      </script>





</head>







<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="https://nolanmiller.me/">Nolan Miller</a>
    </h1>

    <div class="flex">
        

        
        
      
        <p class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/posts" >
                /posts
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      





<div class="breadcrumbs">
    
    <a href="/">Home</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a href="/posts/">Posts</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a class="breadcrumbs-current" href="/posts/quidditch---powered-by-postgresql-and-asp.net/">Quidditch - Powered By PostgreSQL and ASP.NET</a>
</div>



<div >

  <div class="single-intro-container">

    

    <h1 class="single-title">Quidditch - Powered By PostgreSQL and ASP.NET</h1>
    
    <p class="single-summary">Use Entity Framework to connect Postgres to your ASP.NET API.</p>
    

    

    <p class="single-readtime">
      
      
      
      <time datetime="2025-06-10T00:00:00&#43;00:00">June 10, 2025</time>
      

      
      &nbsp; · &nbsp;
      11 min read
      
    </p>

  </div>

  

  
  

  <div class="single-tags">
    
    <span>
      <a href="https://nolanmiller.me/tags/postgres/">#Postgres</a>
    </span>
    
    
    <span>
      <a href="https://nolanmiller.me/tags/asp/">#Asp</a>
    </span>
    
    
    <span>
      <a href="https://nolanmiller.me/tags/dotnet/">#Dotnet</a>
    </span>
    
    
    <span>
      <a href="https://nolanmiller.me/tags/learning/">#Learning</a>
    </span>
    
    
  </div>

  
  

  

  

  

  <div class="single-content">
    <p>As a software developer, it&rsquo;s important to work on your craft. That&rsquo;s why I&rsquo;ve been studying ASP.NET for the past few months. <a href="https://nolanmiller.me/posts/intro-to-.net-apis-for-a-javascript-developer/">In my last article</a> I walk through how to set up an ASP.NET Minimal Web API. Today, I&rsquo;ll be building on that foundation, by adding a persistent data store, a la PostgreSQL. In order to configure a .NET API to communicate with a PostgreSQL database, I&rsquo;m going to use Entity Framework.</p>
<p>Though I could have worked with my animal sounds API, I decided to implement the database for an app that scores a road trip game that my wife and I took this summer.
I recently saw a video about a new road trip game that&rsquo;s inspired by Harry Potter (my favorite book series). I knew that my wife and I had to try it. If you&rsquo;re interested, the rules of the game are <a href="https://www.instagram.com/reel/DEs-Stox4d2/?hl=en">described in this video,</a> and you can play using my score tracker at <a href="https://quidditchtrip.nolanmiller.me">https://quidditchtrip.nolanmiller.me</a>.</p>
<p>In this article, I&rsquo;ll go over making sure that you have PostgreSQL installed and running, and then how to install and configure Entity Framework to read to and write from the database.</p>
<h2 class="heading" id="what-youll-need-to-start">
  What you&rsquo;ll need to start:
  <a class="anchor" href="#what-youll-need-to-start">#</a>
</h2>
<ul>
<li>A .NET Web API (that you&rsquo;ve created <a href="https://nolanmiller.me/posts/supercharge-your-productivity-with-the-.net-cli/">using the dotnet CLI</a>)</li>
<li>Access to an internet connection</li>
<li>A little bit of patience</li>
</ul>
<h2 class="heading" id="install-postgres">
  Install Postgres
  <a class="anchor" href="#install-postgres">#</a>
</h2>
<p>There are a few different methods to installing and starting a Postgres server on your machine, but the easiest route is downloading Postgres.app, a MacOS postgres server interface that comes bundled with the <code>psql</code> CLI. If you&rsquo;re not on Mac, or if you&rsquo;re interested in other installation methods the <a href="https://www.postgresql.org/download/">official Postgres website</a> has installation instructions for every operating system and includes instructions for other installation methods.</p>
<p>Once you&rsquo;re done you should be able to start your Postgres server and also connect to it using the <code>psql</code> command line interface.</p>
<h2 class="heading" id="create-a-database">
  Create a database
  <a class="anchor" href="#create-a-database">#</a>
</h2>
<p>Before we can start creating our models and writing data, we need to make sure that we have a database for our application. To do this, connect to <code>psql</code> using the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>psql -U postgres
</span></span></code></pre></div><p>This will connect us to the Postgres server with the default user <code>postgres</code>. If it prompts  you for a password, it should be the default password, <code>postgres</code>.</p>
<p>Once you&rsquo;re connected you should see a prompt that ends with <code>#</code> and we can issue the following SQL command:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>postgres<span style="color:#ff7b72;font-weight:bold">=#</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">CREATE</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">DATABASE</span><span style="color:#6e7681"> </span>Quidditch;<span style="color:#6e7681">
</span></span></span></code></pre></div><p>Since this database is for my Quidditch app, I&rsquo;ll name it <code>Quidditch</code>, just replace this with whatever name makes sense for your application.</p>
<h2 class="heading" id="connect-to-your-database">
  Connect to your database
  <a class="anchor" href="#connect-to-your-database">#</a>
</h2>
<p>With a database set up, it can be connected to our .NET application using Entity Framework, an object-relational mapper for the .NET ecosystem. EF will automate reading and writing data on our database, and handle table creation and modifications through the development process.</p>
<p>To get started with EF for Postgres, install two NuGet packages by running the following commands from a terminal in your .NET project:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>dotnet add package Microsoft.EntityFrameworkCore.PostgreSQL
</span></span><span style="display:flex;"><span>dotnet add package Microsoft.EntityFrameworkCore.Design
</span></span></code></pre></div><p>To interact with a database we have to create a database context to allow us to interface with the database, configure the context object to use the proper connection string, set up models and create a migration using EF that will scaffold our database.</p>
<h2 class="heading" id="1-database-context">
  1. Database Context
  <a class="anchor" href="#1-database-context">#</a>
</h2>
<p>To create a database context, create a class that inherits from EF&rsquo;s DbContext class, like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff7b72">using</span> <span style="color:#ff7b72">Microsoft.EntityFrameworkCore</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">public</span> <span style="color:#ff7b72">class</span> <span style="color:#f0883e;font-weight:bold">QuidditchContext</span> : DbContext
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">public</span> QuidditchContext(DbConextOptions&lt;QuidditchContext&gt; options) : <span style="color:#ff7b72">base</span>(options) { }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Then wire it into your <code>Program.cs</code> file.</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// in Program.cs</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">var</span> connectionString = <span style="color:#a5d6ff">&#34;[Your connection string]&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>builder.Services.AddDbContext&lt;QuidditchContext&gt;(options =&gt; options.UseNpgsql(connectionString));
</span></span></code></pre></div><p>This way of setting a connection string isn&rsquo;t secure, and should only be used for testing. Make sure that you load these in via a config file!</p>
<p>And with these two small additions, Entity Framework can access your database server.</p>
<h2 class="heading" id="2-set-up-models">
  2. Set up models
  <a class="anchor" href="#2-set-up-models">#</a>
</h2>
<p>The next step in configuration is defining the models that we want to persist. For my Quidditch game, since it&rsquo;s a simple score tracker, I really only need to capture two data models: games and teams. Instead of creating two database tables for these and setting up their columns, I can just create the model in my C# code and EF will reason out the structure of the database!</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff7b72">public</span> <span style="color:#ff7b72">class</span> <span style="color:#f0883e;font-weight:bold">Team</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">public</span> <span style="color:#ff7b72">int</span> TeamKey { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">public</span> <span style="color:#ff7b72">string</span> Name { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">public</span> <span style="color:#ff7b72">int</span> Score { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">public</span> <span style="color:#ff7b72">bool</span> IsActive { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">public</span> DateTime CreatedDateTime { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">public</span> <span style="color:#ff7b72">int?</span> GameKey { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	[JsonIgnore]
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">public</span> Game Game { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">public</span> <span style="color:#ff7b72">class</span> <span style="color:#f0883e;font-weight:bold">Game</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">public</span> <span style="color:#ff7b72">int</span> GameKey { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">public</span> DateTime GameStartDateTime { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">public</span> DateTime? GameEndDateTime { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">public</span> <span style="color:#ff7b72">bool</span> IsActive { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; } = <span style="color:#79c0ff">true</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">public</span> <span style="color:#ff7b72">bool</span> IsFinished =&gt; GameEndDateTime != <span style="color:#79c0ff">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">public</span> List&lt;Team&gt; Teams { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; } = <span style="color:#ff7b72">new</span> List&lt;Team&gt;();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>A couple of things to point out here. First, I&rsquo;m using the terminology <code>[Entity]Key</code> to define my primary keys. This is <em>not</em> automatically picked up by EF. They would prefer that you use <code>[Entity]Id</code> instead. Unfortunately, I am stubborn and would have been mistyping &ldquo;Key&rdquo; instead of &ldquo;Id&rdquo; of for the whole project, so I took the extra couple of steps to define my keys and relationships.</p>
<p>When I add these models to my database context in the next step, EF will use these models to set up tables and columns based on them. Not everything will be one for one though. There are two special properties here. The <code>Team.Game</code> property and the <code>Game.Teams</code> properties are called <em>Navigations</em>.</p>
<p>A Navigation property models a relationship between two tables. They work by associating related models using primary and foreign keys on the models and are kept in sync by EF.</p>
<p>Before these will behave as expected, we need to register these models in our <code>DbContext</code> with <code>DbSet</code> properties. This can be done as easily as adding properties to any other class, but set the type to <code>DbSet&lt;[Entity]&gt;</code> where <code>[Entity]</code> is the model that you want to register.</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// QuidditchContext</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">public</span> <span style="color:#ff7b72">class</span> <span style="color:#f0883e;font-weight:bold">QuidditchContext</span> : DbContext
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">public</span> QuidditchContext(DbConextOptions&lt;QuidditchContext&gt; options) : <span style="color:#ff7b72">base</span>(options) { }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">public</span> DbSet&lt;Team&gt; Teams { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">public</span> DbSet&lt;Game&gt; Games { <span style="color:#ff7b72">get</span>; <span style="color:#ff7b72">set</span>; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The <code>DbSet&lt;&gt;</code> class comes from Entity Framework and inherits from <code>IEnumerable&lt;T&gt;</code>, which allows us to use LINQ (and some Entity Framework specific versions of LINQ) to access our models.</p>
<p>Since I decided to use a different convention for my primary and foreign keys, I have another configuring step to define the relationships between my tables. To manually define table and column relationships, override the <code>OnModelCreating</code> method in <code>DbContext</code>. The relationships that I used are below.</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff7b72">public</span> <span style="color:#ff7b72">class</span> <span style="color:#f0883e;font-weight:bold">QuidditchContext</span> : DbContext
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#8b949e;font-style:italic">// ...</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">protected</span> <span style="color:#ff7b72">override</span> <span style="color:#ff7b72">void</span> OnModelCreating(ModelBuilder modelBuilder)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>		<span style="color:#8b949e;font-style:italic">// .HasKey tell EF what the name of the primary key should be</span>
</span></span><span style="display:flex;"><span>        modelBuilder.Entity&lt;Team&gt;()
</span></span><span style="display:flex;"><span>            .HasKey(t =&gt; t.TeamKey);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        modelBuilder.Entity&lt;Game&gt;()
</span></span><span style="display:flex;"><span>            .HasKey(g =&gt; g.GameKey);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#8b949e;font-style:italic">// These methods define the one-to-many relationship in</span>
</span></span><span style="display:flex;"><span>		<span style="color:#8b949e;font-style:italic">// what looks like plain language. </span>
</span></span><span style="display:flex;"><span>        modelBuilder.Entity&lt;Team&gt;()
</span></span><span style="display:flex;"><span>            .HasOne(e =&gt; e.Game)
</span></span><span style="display:flex;"><span>            .WithMany(e =&gt; e.Teams)
</span></span><span style="display:flex;"><span>            .HasForeignKey(t =&gt; t.GameKey)
</span></span><span style="display:flex;"><span>            .OnDelete(DeleteBehavior.SetNull);
</span></span><span style="display:flex;"><span>        <span style="color:#8b949e;font-style:italic">// .OnDelete can set what happens to related tables</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b949e;font-style:italic">// when the record they reference is deleted.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#8b949e;font-style:italic">// I don&#39;t want a table to be created for this model.</span>
</span></span><span style="display:flex;"><span>        modelBuilder.Ignore&lt;LeaderboardEntry&gt;();
</span></span><span style="display:flex;"><span>    }	
</span></span></code></pre></div><p>Even if you&rsquo;re not using custom naming for your properties, it is probably a good idea to override this method so that your complex relationships are explicitly set by you. This will help mitigate unexpected behavior and has the added benefit of providing some in-code documentation.</p>
<p>Now that configuration is done, it&rsquo;s time to create a database through a process called migration.</p>
<h2 class="heading" id="3-create-a-migration">
  3. Create a migration
  <a class="anchor" href="#3-create-a-migration">#</a>
</h2>
<p>As you work on a project, inevitably the shape of your data will change here and there. Instead of manually updating your database tables, Entity Framework handles this through <em>migrations.</em></p>
<p>Since the models are already defined in the code, Entity Framework can scaffold and re-scaffold database, throughout the lifecycle of the application. A migration can be created using the <code>dotnet</code> CLI with the following command.</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>dotnet ef migrations add InitialCreate
</span></span></code></pre></div><p>With <code>dotnet ef</code> the Entity Framework-specific tools are specified, and then using the <code>migrations add</code> command a migration is created called <code>InitialCreate</code>. A migration can have any name, but it&rsquo;s a good idea to give it a descriptive title for when you need to roll your changes back.</p>
<p>To finalize the changes on our database (or &ldquo;creation of&rdquo; in this instance) we still have to run one more command. EF separates this process of updating the database into two steps. In the first step, a few things happen:</p>
<ul>
<li>a <code>Migrations</code> directory is created in the root of your project if not already there</li>
<li>a <code>[TIMESTAMP]_InitialCreate.cs</code> file is generated, containing the steps to implement the changes to your context, and steps to walk it back if needed.</li>
<li>a <code>[TIMESTAMP]_InitialCreate.Designer.cs</code> file is generated with metadata for EF to use.</li>
<li>a <code>MyContextModelSnapshot.cs</code> file containing a current snapshot of your context model is created.</li>
</ul>
<p>The syntax in these files is fairly easy to interpret, so it&rsquo;s a good idea to do a once-over of the <code>Up</code> method in the <code>[TIMESTAMP]_InitialCreate.cs</code> method so that you aren&rsquo;t surprised by any changes!</p>
<p>Now to finalize those changes and apply them to the database run the following command.</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>dotnet ef database update
</span></span></code></pre></div><p>This will updates the database to the most recent migration. Be careful as you do this, there is potential for data loss when running this command! Now, the database and it&rsquo;s tables are set up and ready for you to start querying!</p>
<h2 class="heading" id="using-linq-to-access-your-data">
  Using LINQ to access your data
  <a class="anchor" href="#using-linq-to-access-your-data">#</a>
</h2>
<p>To illustrate how to query a database using Entity Framework, take a look at one of the service methods that I created for my application:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff7b72">public</span> <span style="color:#ff7b72">async</span> Task&lt;ServiceResponse&lt;Game&gt;&gt; GetGameByKey(<span style="color:#ff7b72">int</span> gameKey)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">var</span> game = <span style="color:#ff7b72">await</span> _context.Games
</span></span><span style="display:flex;"><span>		.Include(g =&gt; g.Teams)
</span></span><span style="display:flex;"><span>		.SingleAsync(g =&gt; g.GameKey == gameKey);
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">if</span> (game == <span style="color:#79c0ff">null</span>) { <span style="color:#ff7b72">return</span> ServiceResponse&lt;Game&gt;.Failure(<span style="color:#a5d6ff">&#34;...&#34;</span>); }
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">return</span> ServiceResponse&lt;Game&gt;.Success(game);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>If you&rsquo;re familiar with LINQ syntax, then this should be familiar.</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff7b72">public</span> <span style="color:#ff7b72">async</span> Task&lt;ServiceResponse&lt;Game&gt;&gt; GetGameByKey(<span style="color:#ff7b72">int</span> gameKey)
</span></span></code></pre></div><p>First, I&rsquo;m declaring a method called <code>GetGameByKey</code>, that returns a custom response object with the generic type <code>Game</code>. I just created a response class with a generic <code>Payload</code> property so that I can send back metadata along with the requested models if needed.</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff7b72">var</span> game = <span style="color:#ff7b72">await</span> _context.Games
</span></span><span style="display:flex;"><span>		.Include(g =&gt; g.Teams)
</span></span><span style="display:flex;"><span>		.SingleAsync(g =&gt; g.GameKey == gameKey);
</span></span></code></pre></div><p>This line queries the database, translating the database record into a usable model and assigning it to a variable that we can return from the method! By default, navigation properties are not included, but using <code>.Include()</code> and specifying the navigation property includes the related navigation in the query.</p>
<p>Query execution is signaled by the <code>.SingleAsync()</code> method, which works the same way as <code>.Single()</code> in LINQ. So this query, will return a only a single record where the <code>GameKey</code> column&rsquo;s value is equal to the <code>gameKey</code> argument passed in when this method is called.</p>
<p>Here&rsquo;s another method example:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff7b72">public</span> <span style="color:#ff7b72">async</span> Task&lt;ServiceResponse&lt;Game&gt;&gt; SetGameInactive(<span style="color:#ff7b72">int</span> gameKey)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">var</span> gameResponse = <span style="color:#ff7b72">await</span> GetGameByKey(gameKey);
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">if</span> (!gameResponse.WasSuccessful) { <span style="color:#ff7b72">return</span> gameResponse; }
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">var</span> game = gameResponse.Payload;
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	game.IsActive = <span style="color:#79c0ff">false</span>;
</span></span><span style="display:flex;"><span>	_context.Games.Update(game);
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">var</span> changedRows = <span style="color:#ff7b72">await</span> _context.SaveChangesAsync();
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">if</span> (changedRows &lt; <span style="color:#a5d6ff">1</span>) { <span style="color:#ff7b72">return</span> ServiceResponse&lt;Game&gt;.Failure(<span style="color:#a5d6ff">&#34;Failed.&#34;</span>); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff7b72">return</span> ServiceResponse&lt;Game&gt;.Success(game);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>There&rsquo;s a little more logic going on in this method. The goal is to find the <code>Game</code> with the matching <code>GameKey</code> and then set its <code>IsActive</code> property to <code>false</code>. The <code>Game</code> is retrieved in the same way as the first method we looked at. Once it&rsquo;s been accessed, then it&rsquo;s properties can be updated like any other class instance in C#.</p>
<p>The <code>_context.Games.Update()</code> method prepares EF to send the command to the database. Unlike the first query, the execution is started by <code>SaveChangesAsync()</code>, which returns the number of affected rows. This is the EF pattern for modifying existing data. The changes are made in the code, and <code>SaveChanges()</code> or <code>SaveChangesAsync()</code> must be called.</p>
<p>I hope that this shows just how simple it can be to access the data from a database using familiar C# list patterns. For a full list of methods available to Entity Framework, <a href="https://learn.microsoft.com/en-us/ef/core/querying/">check out their documentation</a>.</p>
<h2 class="heading" id="summary">
  Summary
  <a class="anchor" href="#summary">#</a>
</h2>
<p>If you made it this far, thank you for reading! I hope that you found it helpful and I wish you the best of luck in implementing EF Core into your own C# applications.</p>
<p>This was a unique challenge for me. I primarily write in C# for my job, but we use a custom data access library that requires mapping our models manually. While Entity Framework has some nice quality-of-life features, I found that lose some of the flexibility gained by writing your own SQL.</p>
<p>This was a very simple project, but even still, it felt like I didn&rsquo;t save much time by using an ORM. Rather than save time on having to write SQL, I traded that time for configuring my database and tables in C#.</p>
<p>In my day job, I rely on libraries that have been provided for me, so I&rsquo;m looking forward to learning how to implement database connections on my own. I don&rsquo;t know that I would choose to use Entity Framework again. I liked how easy it was to set up my models and navigations made implementing business logic very nice, but the configuration of relationships just wasn&rsquo;t as straightforward as it is in SQL.</p>
<p>Regardless, it is always good to take some time to learn new technologies.</p>
<p>Thanks again for reading!</p>

    
  </div>

  


  

  
  

<div class="single-pagination">
    <hr />

    <div class="flex">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">←</div>
                <div class="single-pagination-text">
                    <a href="/posts/intro-to-.net-apis-for-a-javascript-developer/">
                        Intro to .NET APIs for a JavaScript Developer
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
            <div class="single-pagination-container-next">
                <div class="single-pagination-text">
                    <a href="/posts/the-perfect-programming-environment/">
                        The Perfect Programming Environment
                    </a>
                </div>
                <div class="single-pagination-text">→</div>
            </div>
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>

<iframe width="540" height="650" src="https://d782b8fa.sibforms.com/serve/MUIFALLieswUJmHTwIGy-U1O-vXH4y8D30R4YZ-kURtFpFXxKrJtV5k9T_7VvfJ0ATj3f7mZcsatfsBFPQmtX4FsM2QorSR4oRu1jGOF_rZ8hT4R8O0tA_TBTsF92Q3jfbisPdRCOLfJ7VFlBdpbfPfW33bRUdlhuIHFIALBgi9oA_C-MR8hRP1p8Pqqo7ynv_6fN06e5fNDcejz" frameborder="0" scrolling="no" allowfullscreen style="display: block;margin-left: auto;margin-right: auto;max-width: 100%;"></iframe>


    </main>
  </div>

  <footer>
    

    
    <p>Powered by
        <a href="https://gohugo.io/">Hugo</a>
        and
        <a href="https://github.com/tomfran/typo">tomfran/typo</a>
    </p>
    
    
    


  </footer>

  
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">
<script defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script>

<script defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"
  onload="renderMathInElement(document.body);"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false }
      ]
    });
  });
</script>
  

</body>

<script>

  function isAuto() {
    return document.body.classList.contains("auto");
  }

  function setTheme() {
    if (!isAuto()) {
      return
    }

    document.body.classList.remove("auto");
    let cls = "light";
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      cls = "dark";
    }

    document.body.classList.add(cls);
  }

  function invertBody() {
    document.body.classList.toggle("dark");
    document.body.classList.toggle("light");
  }

  if (isAuto()) {
    window.matchMedia('(prefers-color-scheme: dark)').addListener(invertBody);
  }

  setTheme();

</script>

<script defer src="/js/copy-code.js"></script>
</html>